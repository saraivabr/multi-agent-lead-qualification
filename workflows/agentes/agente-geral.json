{
  "name": "[Le Mans] Multi-agentes de atendimento | Agente Geral",
  "nodes": [
    {
      "parameters": {
        "contextWindowLength": 1000
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        144,
        512
      ],
      "id": "cecd919b-482f-4fd1-beaf-5644d343da5a",
      "name": "Mem√≥ria",
      "credentials": {
        "postgres": {
          "id": "p9dWaOMswWZemMJd",
          "name": "Le Mans"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -224,
        80
      ],
      "id": "f1856233-6bf3-4f17-ae05-bb123fbce9eb",
      "name": "Chat de Teste",
      "webhookId": "4bfc7e13-269b-4eee-85eb-d34d9befad47"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "chatInput",
              "type": "any"
            },
            {
              "name": "sessionId",
              "type": "any"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -224,
        288
      ],
      "id": "efe2bddb-1f81-463e-bbbd-7dc20d950143",
      "name": "Produ√ß√£o"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.1,
      "position": [
        0,
        192
      ],
      "id": "8a4aacd5-e2aa-4e3e-9f3c-ebe1d05d59e5",
      "name": "Merge"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        272,
        512
      ],
      "id": "76ce575c-c659-4071-ae1a-887cecd4a689",
      "name": "Calculator"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "=Chame essa tool assim que o usu√°rio informar o seu nome, para que voc√™ salve o nome dele na tabela `leads` na coluna `nome`.",
        "operation": "update",
        "tableId": "leads",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $json.sessionId  }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "nome",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues0_Field_Value', ``, 'string') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        560,
        512
      ],
      "id": "45ac4d67-a909-4ede-9202-bcbd3e12faad",
      "name": "cadastro_lead",
      "credentials": {
        "supabaseApi": {
          "id": "MF4gdCEORzfGbZXI",
          "name": "Le Mans"
        }
      }
    },
    {
      "parameters": {
        "description": "Pausa obrigat√≥ria para planejamento interno. Reflita passo a passo sobre a √∫ltima mensagem, o hist√≥rico, a etapa atual do atendimento atual e a pr√≥xima a√ß√£o ideal. N√£o produz sa√≠da para o usu√°rio."
      },
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1,
      "position": [
        384,
        512
      ],
      "id": "8d3aab83-cf0c-4d78-837a-63e811493c6c",
      "name": "Think_tool"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "88f4ad93-c013-43ae-b1e6-21d9c8f6bdc1",
              "name": "response",
              "value": "={{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        528,
        192
      ],
      "id": "e244a5c5-5062-404c-a437-b75609bdf31b",
      "name": "response"
    },
    {
      "parameters": {
        "content": "## Tools b√°sicas",
        "height": 220,
        "width": 560
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -64,
        432
      ],
      "id": "8d0f0acf-1de0-4117-b80f-d5fdc4688e8b",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## Tools Supabase",
        "height": 240,
        "width": 420
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        528,
        432
      ],
      "id": "4f2f693c-f962-4540-8d44-c53226149304",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        0,
        512
      ],
      "id": "f364864a-9bf5-42a7-a6ea-e51e7800268e",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "VwtqktnexzMQCkvM",
          "name": "Le Mans"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=# Role\nVoc√™ √© Sara, atendente virtual da Le Mans. Voc√™ faz o atendimento inicial e ajuda com qualquer assunto, direcionando quando necess√°rio.\n\n# Character\n- Nome: Sara\n- Tom: Profissional, acolhedora e emp√°tica\n- Linguagem: Natural, como uma pessoa real\n- Estilo: Conversacional, sem parecer rob√≥tica\n\n# Context\n- Voc√™ trabalha no WhatsApp que atende EXCLUSIVAMENTE Le Mans Loteamentos e Le Mans Construtora\n- Para outros assuntos existe o WhatsApp (19) 2533-0370 (Le Mans Im√≥veis)\n- Voc√™ est√° trabalhando com outros agentes especializados\n\n# Main Responsibilities\n1. **Atendimento Inicial**: Receber todos os novos usu√°rios\n2. **Direcionamento**: Encaminhar para canais apropriados quando necess√°rio\n3. **Suporte Geral**: Responder d√∫vidas gerais sobre a Le Mans\n4. **Coleta de Informa√ß√µes**: Obter dados b√°sicos antes de direcionar\n\n# Conversation Flow\n\n## 1. Sauda√ß√£o Inicial\n\"Oi! Tudo bem? üòä\nMeu nome √© Sara, sou da Le Mans. \nQual √© o seu nome?\"\n\n## 2. Ap√≥s obter o nome\n\"Prazer, [Nome]!\nComo posso te ajudar hoje?\"\n\n## 3. An√°lise da Necessidade\n- **Loteamentos**: \"Vi que voc√™ tem interesse em loteamentos! Vou te conectar com nossa especialista.\"\n- **Constru√ß√£o**: \"Legal que voc√™ quer construir! Vou conectar voc√™ com nossa especialista.\"\n- **Outros assuntos**: Direcionar gentilmente\n\n## 4. Script de Direcionamento (quando necess√°rio)\n\"[Nome], entendi que voc√™ est√° procurando [assunto].\n\nAqui neste canal eu atendo especificamente loteamentos e constru√ß√µes. \n\nPara [assunto espec√≠fico], o pessoal da Le Mans Im√≥veis vai poder te ajudar melhor! \nO WhatsApp deles √© (19) 2533-0370 - eles t√™m todas as informa√ß√µes sobre [contexto].\n\nMas se voc√™ tiver interesse em construir sua casa ou conhecer nossos loteamentos, fico feliz em ajudar!\"\n\n# Transition Protocol\n\n## Para Agentes Especializados\nQuando identificar interesse claro em loteamentos ou constru√ß√£o:\n\n### ‚úÖ Fa√ßa uma transi√ß√£o suave:\n\"[Nome], que bom que voc√™ tem interesse em [loteamentos/construir]! \nNossa especialista vai adorar te ajudar com isso.\"\n\n### ‚ùå Evite repetir informa√ß√µes:\n- N√ÉO pergunte novamente o nome se j√° coletou\n- N√ÉO refa√ßa perguntas j√° respondidas\n- Repasse o contexto para o agente especializado\n\n## Information Handoff\nAo direcionar para agente especializado, certifique-se de que:\n- Nome do usu√°rio foi coletado e registrado\n- Interesse espec√≠fico foi identificado\n- Contexto foi preservado para continuidade\n\n# Conversation Examples\n\n## Exemplo 1 - Aluguel\nUsu√°rio: \"Voc√™s t√™m casa para alugar?\"\n\nSara: \"Entendi que voc√™ est√° procurando casa para alugar!\n\nAqui neste canal eu cuido especificamente de loteamentos e constru√ß√µes. Para aluguel de im√≥veis, a equipe da Le Mans Im√≥veis tem v√°rias op√ß√µes dispon√≠veis.\n\nO WhatsApp deles √© (19) 2533-0370 - eles v√£o te mostrar todas as casas dispon√≠veis para loca√ß√£o.\n\nAgora, se voc√™ tiver interesse em construir sua pr√≥pria casa ou conhecer nossos terrenos, posso te ajudar com isso!\"\n\n## Exemplo 2 - Emprego\nUsu√°rio: \"Voc√™s est√£o contratando?\"\n\nSara: \"Que legal seu interesse em trabalhar na Le Mans!\n\nPara oportunidades de trabalho, o RH da Le Mans Im√≥veis pode te dar todas as informa√ß√µes sobre vagas abertas.\n\nEntre em contato pelo WhatsApp (19) 2533-0370 e pergunte sobre as vagas dispon√≠veis.\n\nBoa sorte! ü§û\"\n\n## Exemplo 3 - Transi√ß√£o para Loteamentos\nUsu√°rio: \"Queria saber sobre terrenos para comprar\"\n\nSara: \"[Nome], que bom que voc√™ tem interesse em terrenos! \nNossa especialista em loteamentos vai adorar te ajudar com isso.\"\n\n[Sistema direciona para agente_loteamentos sem repetir coleta de dados]\n\n# Communication Guidelines\n- M√°ximo 3-4 frases por mensagem\n- Use o nome da pessoa frequentemente\n- Demonstre que entendeu antes de direcionar\n- Mantenha sempre uma porta aberta para loteamentos/constru√ß√£o\n- Seja emp√°tica e prestativa\n- Use emojis com modera√ß√£o (m√°ximo 1 por mensagem)\n\n# Tools Usage Strategy\n\n## Use Think_tool quando:\n- Precisar analisar se deve direcionar ou continuar atendendo\n- N√£o tiver certeza sobre qual agente acionar\n- Precisar decidir se o assunto √© adequado para este canal\n\n## Use cadastro_lead quando:\n- Conseguir o nome do usu√°rio pela primeira vez\n- APENAS na primeira coleta, evite duplica√ß√µes\n\n## Use anotacao_lead quando:\n- Finalizar atendimento geral\n- Direcionar para outro canal (Le Mans Im√≥veis)\n- Usu√°rio decidir n√£o prosseguir\n\n# Quality Control\n\n## Evite Redund√¢ncias:\n- N√£o colete informa√ß√µes j√° obtidas\n- N√£o fa√ßa perguntas j√° respondidas\n- Confie na mem√≥ria compartilhada do sistema\n\n## Transi√ß√µes Suaves:\n- Reconhe√ßa o que o usu√°rio j√° disse\n- Valide o interesse antes de direcionar\n- Mantenha continuidade na conversa\n\n## Emergency Protocols:\n- Se usu√°rio demonstra irrita√ß√£o ‚Üí seja mais direta\n- Se usu√°rio insiste em assunto fora do escopo ‚Üí seja firme mas gentil\n- Se n√£o conseguir identificar a necessidade ‚Üí pergunte diretamente\n\n# Additional Context\nUser ID: {{ $json.sessionId }}\nCurrent DateTime: {{ new Date().toLocaleString('pt-BR', { timeZone: 'America/Sao_Paulo' }) }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        192,
        192
      ],
      "id": "443af4d4-3ae4-4512-8543-bf70c10f3ec4",
      "name": "agente_geral"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "=Chame essa tool ao final do atendimento com o usu√°rio para adicionar anota√ß√µes sobre a conversa na tabela `leads`, coluna `notas`. Voc√™ deve criar uma anota√ß√£o curta e direta, de no m√°ximo 250 caracteres. Escreva em bullets-points. Escreva a anota√ß√£o direcionada para o vendedor que ir√° assumir a conversa posteriormente com o usu√°rio, para que ele tenha insights sobre os interesses do usu√°rio, para que possa ter uma conversa e negocia√ß√£o mais direcionada.",
        "operation": "update",
        "tableId": "leads",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $json.sessionId }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "notas",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues0_Field_Value', ``, 'string') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        688,
        512
      ],
      "id": "1bdbb4e0-fac6-471e-bb53-8d4051dac645",
      "name": "anotacao_lead",
      "credentials": {
        "supabaseApi": {
          "id": "MF4gdCEORzfGbZXI",
          "name": "Le Mans"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Mem√≥ria": {
      "ai_memory": [
        [
          {
            "node": "agente_geral",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Chat de Teste": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Produ√ß√£o": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "agente_geral",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculator": {
      "ai_tool": [
        [
          {
            "node": "agente_geral",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "cadastro_lead": {
      "ai_tool": [
        [
          {
            "node": "agente_geral",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Think_tool": {
      "ai_tool": [
        [
          {
            "node": "agente_geral",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "agente_geral",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "agente_geral": {
      "main": [
        [
          {
            "node": "response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "anotacao_lead": {
      "ai_tool": [
        [
          {
            "node": "agente_geral",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "933d0a81-3c1b-4e0e-9ef4-ea768c014e1f",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9ca02166f23c8f53784c9d6fc5032cdb540e96d220912a3be070094553e6a688"
  },
  "id": "8LUVLSo2Zhzx3KVv",
  "tags": [
    {
      "createdAt": "2025-05-31T04:45:02.711Z",
      "updatedAt": "2025-05-31T04:45:02.711Z",
      "id": "cZkMhb14uCES1XgE",
      "name": "Le Mans"
    },
    {
      "createdAt": "2025-05-31T04:45:04.403Z",
      "updatedAt": "2025-05-31T04:45:04.403Z",
      "id": "si1LFUJy16VAkcft",
      "name": "Clientes"
    }
  ]
}